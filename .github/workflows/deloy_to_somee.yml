# Tên của Workflow
name: ASP.NET Core Deploy to Somee

# Kích hoạt Workflow khi Push code lên nhánh main
on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # Cho phép chạy thủ công từ GitHub UI

# Định nghĩa Job triển khai
jobs:
  deploy:
    # Chạy trên môi trường Linux (nhanh hơn cho .NET Core)
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup .NET SDK
      # RẤT QUAN TRỌNG: Thay '8.0.x' bằng phiên bản .NET Core của bạn
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '6.0.x'

    - name: Restore dependencies
      run: dotnet restore

    - name: Build and Publish
      # Tạo ra thư mục 'publish' chứa các file đã biên dịch
      run: dotnet publish --configuration Release --output ./publish
      
    # --- Triển khai lên Somee qua FTP/SFTP ---
    - name: Deploy via FTP to Somee
      # Sử dụng Action của SamKirkland để triển khai qua FTP/SFTP
      uses: SamKirkland/FTP-Deploy-Action@v4.3.0
      with:
        # Bạn PHẢI lưu các biến này dưới dạng Secrets trong GitHub (FTP_SERVER, FTP_USERNAME, FTP_PASSWORD)
        server: nguyenquochuydh52200787.somee.com
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        
        # Đường dẫn thư mục chứa các file đã Publish
        local-dir: ./publish/
        
        # ĐƯỜNG DẪN TRÊN SERVER: Sử dụng đường dẫn tương đối từ thư mục gốc FTP
        # Đường dẫn gốc thường là /httpdocs/ hoặc /wwwroot/
        # Sau đó trỏ đến thư mục con của ứng dụng bạn đã tạo trên Somee.
        server-directory: /	nguyenquochuydh52200787.somee.com/BT_OSS_Nhom13/ 
        
        # Xóa các file cũ trên server để đảm bảo phiên bản mới nhất
        delete-local: true
